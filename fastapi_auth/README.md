# Сервис идентификации, аутентификации и авторизации пользователей. 

## Описание.
Сервис предназначен для идентификации, аутентификации и авторизации пользователей, управления учетными записями и управления ролями пользователей для предоставления прав доступа к ресурсам сервиса.

### Архитектурное решение:
- **серверная часть**: сервер на Fast API для обработки запросов пользователей и взаимодействия с базой данных и хранилищем токенов;
- **база данных**: реляционная база данных PostgreSQL для хранения информации о пользователях, ролях и правах доступа, refresh JWT токенов;
- **хранилище токенов**: Redis для работы с access токенами (хранение активных access JWT токенов с временем хранения равным времени действия токена);
- **эндпоинты /auth/...**: для идентификации, аутентификации и авторизации пользователей, обработки логинов, паролей и токенов;
- **эндпоинты /user/...**: для управления пользователем своей учетной записью;
- **эндпоинты /admin/...**: для управления админами учетными записями пользователей, ролями (создание/изменение/удаление) и предоставления прав доступа пользователям;
- **документация OpenAPI**: встроенная автоматически генерируемая документация FastAPI на основе спецификаций OpenAPI.

### Основные роли, предполагаемые к использованию в сервисе:
- **admin**: полные права в системе;
- **subscriber, user**: права на управление своей учетной записью;
- **unregestered-user**: права на регистрацию / вход в систему.

### Тесты.
Сделаны тесты для проверки работоспособности 'auth'.

### Основные команды для запуска сервиса:
- **запуск сервиса в docker compose**: 
`docker compose -f docker-compose-auth.yml up -d`;
- **остановка сервиса**: 
`docker compose -f docker-compose-auth.yml down`;
- **запуск тестов**: 
`docker compose -f src/tests/functional/docker-compose.yml up -d`;
- **завершение тестов**: 
`docker compose -f src/tests/functional/docker-compose.yml down -v`.

Более подробно все основные команды представлены в [Makefile](Makefile).

### Суперпользователь:
- **создание суперпользователя**:
`python3 create_superuser.py admin qwerty`,

где, `admin` - логин, `qwerty` - пароль. 
При заупске проекта автоматически создается суперпользователь:
`admin` - логин, `admin` - пароль.

### Миграции:
- **создать миграцию**:
`alembic revision --autogenerate -m "migration1"`,

где `migration1` - имя миграции;
- **применить все миграции**: 
`alembic upgrade head`.


[http://localhost:8001/api/openapi](http://localhost:8001/api/openapi)